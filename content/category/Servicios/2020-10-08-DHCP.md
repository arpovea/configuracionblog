---
title: Configuración DHCP y Tareas
author: Adrián Rodríguez Povea
Summary: Buenas! En esta ocasión se va a realizar la instalación de un servidor DHCP, en un escenario creado con Vagrant, se van a realizar distintas configuraciones y pruebas.

---

Buenas! En esta ocasión se va a realizar la instalación de un servidor DHCP, en un escenario creado con Vagrant, se van a realizar distintas configuraciones y pruebas.

***

## Un poco de Teoría

Explicación teórica con el gráfico.

![graficodhcp]({static}/images/DHCP/graficodhcp.png)

***

## Preparación del escenario

El escenario se va a realizar con Vagrant utilizando libvirt para la virtualizanción. Se van a definir dos máquinas, una donde se instalará el servidor DHCP y otra que servirá como cliente.

El servidor DHCP tendrá en un principio dos interfaces de red, una pública con salida a internet y otra privada en la cual repartirá direcciones del rango 192.168.100.0/24.

A continuación se expone el contenido del fichero Vagrantfile:

```ruby
Vagrant.configure("2") do |config|
  config.vm.define :dhcp do |dhcp|
   dhcp.vm.box = "debian/buster64"
   dhcp.vm.hostname = "dhcp"
   dhcp.vm.synced_folder ".", "/vagrant", disabled: true
   dhcp.vm.network :public_network,
   :dev => 'br0',
   :type => 'bridge'
   dhcp.vm.network :private_network,
   :ip => "192.168.100.1",
   :libvirt__domain_name => "lan1"
   dhcp.vm.provision "shell",
   inline: "sudo ip r del default via 192.168.121.1 dev ens5"
   dhcp.vm.provider :libvirt do |dhcp|
     dhcp.uri = 'qemu+unix:///system'
     dhcp.host = "debian"
     dhcp.cpus = 1
     dhcp.memory = 512
   end
  end
  config.vm.define :clinux do |clinux|
   clinux.vm.box = "debian/buster64"
   clinux.vm.hostname = "clinux"
   clinux.vm.synced_folder ".", "/vagrant", disabled: true
   clinux.vm.network :private_network,
   :type => "dhcp",
   :libvirt__domain_name => "lan1"
   clinux.vm.provision "shell",
   inline: "sudo ip r del default via 192.168.121.1 dev ens5"
   clinux.vm.provider :libvirt do |clinux|
     clinux.uri = 'qemu+unix:///system'
     clinux.host = "debian"
     clinux.cpus = 1
     clinux.memory = 512
   end
  end
end
```

Como se puede observar en esta configuración, se borra la ruta de encaminamiento que crea vagrant por defecto, para que salga exclusivamente por la que se ha especificado.

## Instalación y configuración del servidor DHCP

Una vez iniciado el escenario, accede a la máquina `dhcp` donde se instalará el servidor DHCP. Para ello:

`sudo apt update && sudo apt install isc-dhcp-server`

Al instalarlo el servicio fallará y mandará un mensaje de error, pero es normal ya que aun no esta configurado.

El primer fichero que hay que editar es `/etc/default/isc-dhcp-server` en el cual se indica la interfaz de red donde va a trabajar el servidor DHCP. Dejandolo así:

`INTERFACESv4="ens7"`

Una vez realizado esto el fichero de configuración principal del DHCP es `/etc/dhcp/dhcp.conf`.


***

***
    
Muchas gracias por leer hasta aquí espero que haya servido de ayuda. Un saludo.    
